const e={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"},t=new class{constructor(){this.gridSize=4,this.winningValue=2048,this.reset()}reset(){this.grid=this.createEmptyGrid(),this.score=0,this.status=e.IDLE}start(){this.status=e.PLAYING,this.addNewTile(),this.addNewTile()}restart(){this.reset()}moveLeft(){this.processMove("left")}moveRight(){this.processMove("right")}moveUp(){this.processMove("up")}moveDown(){this.processMove("down")}updateScore(e){this.score=this.score+e}processMove(e){let t=this.calculateNewGrid(e);this.gridsAreEqual(this.grid,t)||(this.grid=t,this.addNewTile(),this.updateGameStatus())}calculateNewGrid(e){switch(e){case"left":return this.moveHorizontal(!1);case"right":return this.moveHorizontal(!0);case"up":return this.moveVertical(!1);case"down":return this.moveVertical(!0);default:return this.copyGrid()}}moveHorizontal(e){return this.grid.map(t=>{let r=[...t];return e&&r.reverse(),r=this.mergeLine(r),e&&r.reverse(),r})}moveVertical(e){let t=this.createEmptyGrid();for(let r=0;r<this.gridSize;r++){let s=this.grid.map(e=>e[r]);e&&(s=s.reverse());let i=this.mergeLine(s);e&&i.reverse(),this.setColumn(t,r,i)}return t}mergeLine(e){let t=e.filter(e=>0!==e),r=0;for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,r+=t[e],t.splice(e+1,1));for(this.score+=r;t.length<this.gridSize;)t.push(0);return t}createEmptyGrid(){return Array.from({length:this.gridSize},()=>Array(this.gridSize).fill(0))}copyGrid(){return this.grid.map(e=>[...e])}setColumn(e,t,r){r.forEach((r,s)=>{e[s][t]=r})}gridsAreEqual(e,t){return e.every((e,r)=>e.every((e,s)=>e===t[r][s]))}addNewTile(){let e=[];if(this.grid.forEach((t,r)=>{t.forEach((t,s)=>{0===t&&e.push([r,s])})}),e.length>0){let[t,r]=e[Math.floor(Math.random()*e.length)];this.grid[t][r]=.9>Math.random()?2:4}}updateGameStatus(){this.hasWinningTile()?this.status=e.WIN:this.hasPossibleMoves()||(this.status=e.LOSE)}hasWinningTile(){return this.grid.some(e=>e.includes(this.winningValue))}hasPossibleMoves(){if(this.grid.some(e=>e.includes(0)))return!0;for(let e=0;e<this.gridSize;e++)for(let t=0;t<this.gridSize;t++){let r=this.grid[e][t],s=t<this.gridSize-1&&r===this.grid[e][t+1],i=e<this.gridSize-1&&r===this.grid[e+1][t];if(s||i)return!0}return!1}getScore(){return this.score}getState(){return this.copyGrid()}getStatus(){return this.status}},r=document.querySelector(".game-score"),s=document.querySelector(".button.start"),i=document.querySelectorAll(".field-cell"),o=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),n=document.querySelector(".message-start");function l(){(function(){let e=t.getState();i.forEach((t,r)=>{let s=e[Math.floor(r/4)][r%4];t.textContent="",t.className=`field-cell${s?` field-cell--${s}`:""}`})})(),r.innerHTML=t.getScore(),function(){let r=t.getStatus();o.classList.toggle("hidden",r!==e.WIN),a.classList.toggle("hidden",r!==e.LOSE),n.classList.toggle("hidden",r!==e.IDLE)}()}s.addEventListener("click",()=>{s.classList.contains("start")?(t.start(),s.textContent="RESTART",s.classList.replace("start","restart")):(t.restart(),s.textContent="START",s.classList.replace("restart","start")),l()}),document.addEventListener("keydown",r=>{if(t.getStatus()===e.PLAYING){switch(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(r.key)&&r.preventDefault(),r.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown();break;default:return}l()}});
//# sourceMappingURL=index.70674864.js.map
